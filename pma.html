<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PMA Mappings Counter</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 40px; }
    .counter-value { font-size: 2.5em; margin: 20px 0; }
    button { padding: 8px 16px; font-size: 16px; border-radius: 5px; border: 1px solid #3498db; background: #3498db; color: white; cursor: pointer; }
    button:hover { background: #217dbb; }
  </style>
</head>
<body>
  <h1>PMA Mappings</h1>
  <div class="counter-value" id="counter">0</div>
  <button onclick="resetCounter()">Reset</button>
  <script>
    const key = "pma-counter";
    const timeKey = "pma-timestamp";
    const increment = 5;
    const intervalMs = 15 * 60 * 1000; // 15 minutes

    function getCount() {
      return parseInt(localStorage.getItem(key) || "0");
    }
    function setCount(val) {
      localStorage.setItem(key, val);
    }
    function getTimestamp() {
      return parseInt(localStorage.getItem(timeKey) || "0");
    }
    function setTimestamp(val) {
      localStorage.setItem(timeKey, val);
    }
    function updateCounterDisplay(val) {
      document.getElementById("counter").textContent = val;
    }
    function resetCounter() {
      setCount(0);
      setTimestamp(Date.now());
      updateCounterDisplay(0);
    }

    // Calculate how many intervals have passed and update accordingly
    function updateCounterOnLoad() {
      let count = getCount();
      let lastTime = getTimestamp();
      let now = Date.now();
      if (!lastTime) {
        lastTime = now;
        setTimestamp(now);
      }
      let intervalsPassed = Math.floor((now - lastTime) / intervalMs);
      if (intervalsPassed > 0) {
        count += increment * intervalsPassed;
        setCount(count);
        setTimestamp(lastTime + intervalsPassed * intervalMs);
      }
      updateCounterDisplay(count);
    }

    // Set up a timer to increment counter every 15 minutes
    function setupTimer() {
      let lastTime = getTimestamp();
      let now = Date.now();
      let msToNextInterval = intervalMs - ((now - lastTime) % intervalMs);
      setTimeout(function() {
        incrementCounter();
        setInterval(incrementCounter, intervalMs);
      }, msToNextInterval);
    }

    function incrementCounter() {
      let count = getCount() + increment;
      setCount(count);
      setTimestamp(Date.now());
      updateCounterDisplay(count);
    }

    window.onload = function() {
      updateCounterOnLoad();
      setupTimer();
    };
  </script>
</body>
</html>
